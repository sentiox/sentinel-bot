# Sentinel Bot

Telegram-бот для управления VPS серверами, мониторинга, оплаты и обновлений Remnawave.

## Установка

```bash
sh <(wget -qO- https://raw.githubusercontent.com/sentiox/sentinel-bot/main/install.sh)
```

Установщик автоматически:
- Установит Python 3, pip, git
- Клонирует репозиторий в `/opt/sentinel-bot/`
- Создаст виртуальное окружение и установит зависимости
- Спросит Bot Token, Admin ID, Group ID
- Создаст systemd сервис и запустит бота

## Возможности

### 1. Панель управления VPS
- Список серверов с статусом (Online/Offline) и оставшимися днями оплаты
- Добавление/удаление серверов (SSH: пароль или ключ)
- Терминал — выполнение команд на сервере прямо из Telegram
- Перезагрузка сервера одной кнопкой
- SSH менеджер — смена пароля

### 2. Оплата VPS
- Привязка платежей к серверам
- Автоматические напоминания: за 7, 3, 1 день и в день оплаты
- После оплаты — выбор срока: 30 / 60 / 90 / 180 / 360 дней
- Изменение даты: ввод даты (DD.MM.YYYY) или дней (+30)
- Оставшиеся дни видны прямо в списке серверов

### 3. Баланс ЮKassa
- Пополнение, списание, оплата — ручной ввод
- Автоматический расчёт остатка
- История операций
- Красивый отчёт с суммами

### 4. Мониторинг серверов
- CPU (загрузка, ядра), RAM, Disk, Network, Uptime, Ping
- Прогресс-бары для визуализации
- Автоматический сбор метрик каждые 5 минут
- Алерты при перегрузке (CPU >90%, RAM >90%, Disk >85%)

### 5. Настройки и админка
- Управление администраторами
- Включение/выключение уведомлений
- Логи всех действий
- Экспорт данных

### 6. Обновления Remnawave
- Update Remnawave Panel
- Update Remnawave Node
- Update Subscription Page
- Clean Docker Images
- Вывод логов после обновления

## Команды

| Команда | Описание |
|---------|----------|
| `/start` | Главное меню |
| `/menu` | Открыть меню |
| `/setup_topics` | Создать топики в группе (выполнять в супергруппе) |

## Топики в группе

Бот работает в супергруппе с включёнными темами (Forum Topics). Команда `/setup_topics` автоматически создаст 6 топиков:

| Топик | Назначение |
|-------|------------|
| Панель VPS | Управление серверами |
| Оплата VPS | Уведомления об оплате |
| Баланс ЮKassa | Операции с балансом |
| Мониторинг | Метрики и алерты |
| Настройки | Админка и логи |
| Обновления | Remnawave обновления |

## Настройка группы

1. Создайте супергруппу в Telegram
2. Откройте **Настройки группы** → включите **Темы**
3. Добавьте бота как **администратора** (права: управление темами, отправка сообщений)
4. Отправьте `/setup_topics` в группе
5. Готово — бот создаст все топики автоматически

## Управление

```bash
# Логи (в реальном времени)
journalctl -u sentinel-bot -f

# Статус
systemctl status sentinel-bot

# Перезапуск
systemctl restart sentinel-bot

# Остановка
systemctl stop sentinel-bot

# Конфигурация
nano /opt/sentinel-bot/.env

# Удаление
bash /opt/sentinel-bot/uninstall.sh
```

## Конфигурация (.env)

```env
BOT_TOKEN=...              # Токен от @BotFather
ADMIN_IDS=123456789        # Telegram ID админа
GROUP_ID=-100...           # ID супергруппы

MONITOR_INTERVAL=300       # Интервал мониторинга (сек)
ALERT_CPU_THRESHOLD=90     # Порог алерта CPU (%)
ALERT_RAM_THRESHOLD=90     # Порог алерта RAM (%)
ALERT_DISK_THRESHOLD=85    # Порог алерта Disk (%)
REMINDER_DAYS=7,3,1,0      # Дни напоминаний об оплате
```

## Стек

- Python 3.11+ / aiogram 3
- SQLite (aiosqlite)
- Paramiko (SSH)
- APScheduler
- psutil
